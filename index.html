<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sporty Predictor — Football · Basketball · Tennis (Open sources)</title>
<style>
  :root{
    --bg1:#041528; --bg2:#093046; --card:#071f2b;
    --accent1:#06b6d4; --accent2:#7c3aed; --accent3:#ff7ab6;
    --muted:#9fb3c7; --good:#a7f3d0; color:#eaf6ff;
  }
  *{ box-sizing:border-box; }
  body{
    margin:0; font-family:Inter,system-ui,Arial; min-height:100vh;
    background:linear-gradient(180deg,var(--bg1),var(--bg2)); color:var(--card);
    display:flex; align-items:center; justify-content:center; padding:18px;
  }
  .app{ width:100%; max-width:1100px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; padding:18px; box-shadow:0 20px 60px rgba(2,6,23,0.6); color: #eaf6ff; }
  header{ display:flex; gap:14px; align-items:center; }
  h1{ margin:0; font-size:20px; letter-spacing:0.2px; }
  .tag{ font-size:12px; color:var(--muted) }
  .lead{ color:var(--muted); margin-top:6px; font-size:13px }

  .controls{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; margin-top:14px; }
  .panel{ background:rgba(0,0,0,0.12); padding:12px; border-radius:10px; }
  label{ display:block; font-size:13px; color:var(--muted); margin-bottom:6px }
  input[type=text], input[type=date], select, input[type=number]{
    width:100%; padding:10px 12px; border-radius:8px; border:none; background:rgba(255,255,255,0.03); color:inherit;
  }
  .row{ display:flex; gap:8px; align-items:center; margin-top:12px; }
  button{ padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:700; color:#021226; background:linear-gradient(90deg,var(--accent1),var(--accent2)); }
  .btn-ghost{ background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.04); padding:8px 10px; border-radius:8px; cursor:pointer; }
  .output{ margin-top:16px; padding:12px; border-radius:10px; background:linear-gradient(180deg, rgba(0,0,0,0.14), rgba(0,0,0,0.08)); color: #eaf6ff; }
  .bars{ display:flex; gap:10px; align-items:center; margin-top:8px; }
  .bar{ flex:1; height:16px; background:rgba(255,255,255,0.05); border-radius:8px; overflow:hidden; }
  .fillA{ height:100%; width:0%; background:linear-gradient(90deg,var(--accent1),var(--accent2)); transition:width .8s; }
  .fillB{ height:100%; width:0%; background:linear-gradient(90deg,var(--accent3),#f97316); transition:width .8s; }

  .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:12px; }
  .stat{ background:rgba(255,255,255,0.03); padding:10px; border-radius:8px }
  .stat .muted{ color:var(--muted); font-size:13px }
  .explain{ margin-top:12px; background:rgba(0,0,0,0.12); padding:10px; border-radius:8px; color:var(--muted); font-size:13px; max-height:230px; overflow:auto }
  .logo{ width:56px; height:56px; border-radius:8px; background:rgba(255,255,255,0.03); display:flex; align-items:center; justify-content:center; overflow:hidden }
  img.logo-img{ width:100%; height:100%; object-fit:cover; }

  footer{ margin-top:12px; display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; color:var(--muted); font-size:13px; }

  @media (max-width:900px){ .controls{ grid-template-columns:1fr } .grid2{ grid-template-columns:1fr } .logo{ width:44px; height:44px } }
</style>
</head>
<body>
  <div class="app" role="main">
    <header>
      <div style="flex:1">
        <h1>Sporty Predictor</h1>
        <div class="tag">Football · Basketball · Tennis — Open sources (Wikipedia & Pageviews)</div>
        <div class="lead">No API keys required. Uses public signals; falls back to deterministic simulation for reproducible predictions.</div>
      </div>
      <div style="display:flex; gap:8px; align-items:center">
        <div class="logo" id="logoLeft" title="entity logo"><img id="logoLeftImg" class="logo-img" alt="" src="" style="display:none"></div>
      </div>
    </header>

    <div class="controls" style="margin-top:12px">
      <div class="panel">
        <label>Sport</label>
        <select id="sport">
          <option value="football">Football (soccer)</option>
          <option value="basketball">Basketball</option>
          <option value="tennis">Tennis</option>
        </select>

        <label style="margin-top:8px">Primary (Team / Player A)</label>
        <input id="nameA" type="text" placeholder="e.g. Manchester United or Novak Djokovic">

        <label style="margin-top:8px">Secondary (Team / Player B)</label>
        <input id="nameB" type="text" placeholder="e.g. Liverpool or Rafael Nadal">
      </div>

      <div class="panel">
        <label>Optional numeric ids / match id (not required)</label>
        <input id="idA" type="number" placeholder="Optional id A">
        <input id="idB" type="number" placeholder="Optional id B" style="margin-top:8px">
        <label style="margin-top:8px">Match date (optional)</label>
        <input id="matchDate" type="date">
        <div class="row" style="margin-top:8px">
          <label class="muted" style="display:flex; gap:8px; align-items:center"><input id="homeA" type="checkbox"> Home advantage for A (+small boost)</label>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <button id="predictBtn">Predict (open sources)</button>
      <button id="simulateBtn" class="btn-ghost">Quick simulate</button>
      <button id="clearCache" class="btn-ghost" style="margin-left:auto">Clear cache</button>
    </div>

    <section id="result" class="output" hidden aria-live="polite">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <div style="font-weight:800; font-size:20px" id="scoreMain">—</div>
          <div class="muted" id="matchLabel">—</div>
        </div>
        <div style="text-align:right">
          <div class="muted" id="favText"></div>
          <div class="muted" id="sourceNote"></div>
        </div>
      </div>

      <div class="bars" id="winBars">
        <div style="flex:1;"><div id="labelA" class="muted"></div><div class="bar"><div id="fillA" class="fillA"></div></div></div>
        <div style="flex:1;"><div id="labelB" class="muted"></div><div class="bar"><div id="fillB" class="fillB"></div></div></div>
      </div>

      <div class="grid2">
        <div>
          <div id="mainStats"></div>
        </div>
        <div>
          <div id="eventStats"></div>
        </div>
      </div>

      <div class="explain" id="explainBox"></div>
    </section>

    <footer>
      <div>Built with public data: Wikipedia & Wikimedia Pageviews • Works offline after first lookup</div>
      <div class="muted">Tip: the same input produces the same simulated prediction (deterministic seed)</div>
    </footer>
  </div>

<script>
/* Sporty Predictor — Open-source signals (Wikipedia + Pageviews), deterministic fallback.
   Supports football, basketball, tennis. Single-file; no API keys required. */

const CACHE_KEY = 'sporty_cache_v1';

// deterministic hash + RNG
function hashString(s){
  let h = 2166136261 >>> 0;
  for(let i=0;i<s.length;i++) h = Math.imul(h ^ s.charCodeAt(i), 16777619) >>> 0;
  return h;
}
function seededRng(seed){ let state = seed>>>0; return ()=>{ state = (Math.imul(state,1664525)+1013904223)>>>0; return (state>>>0)/4294967296; }}

// base deterministic stats (name -> strengths)
function baseStats(name){
  const seed = hashString(name.toLowerCase());
  const rnd = seededRng(seed);
  return {
    offense: 0.45 + rnd()*0.55,
    defense: 0.4 + rnd()*0.6,
    form: 0.4 + rnd()*0.6,
    discipline: 0.4 + rnd()*0.6,
    popularity: 0.1 + rnd()*0.9
  };
}

// Wikipedia summary & thumbnail
async function fetchWikiSummary(name){
  try{
    const url = 'https://en.wikipedia.org/api/rest_v1/page/summary/' + encodeURIComponent(name);
    const r = await fetch(url, {cache:'no-store'});
    if(!r.ok) return null;
    const j = await r.json();
    return { title:j.title, extract:j.extract, thumbnail: j.thumbnail && j.thumbnail.source ? j.thumbnail.source : null };
  }catch(e){
    return null;
  }
}

// Wikimedia pageviews (7-day total)
async function fetchPageviews(name){
  try{
    const end = new Date();
    const start = new Date(Date.now() - 6*24*3600*1000);
    const fmt = d => d.toISOString().slice(0,10).replace(/-/g,'');
    const url = `https://wikimedia.org/api/rest_v1/metrics/pageviews/per-article/en.wikipedia/all-access/all-agents/${encodeURIComponent(name)}/daily/${fmt(start)}/${fmt(end)}`;
    const r = await fetch(url, {cache:'no-store'});
    if(!r.ok) return null;
    const j = await r.json();
    if(!j.items) return null;
    return j.items.reduce((s,i)=>s+(i.views||0),0);
  }catch(e){
    return null;
  }
}

// get augmented entity stats (wiki + deterministic)
async function getEntity(name, opts={forceOnline:true}){
  const key = name.trim().toLowerCase();
  if(!key) throw new Error('empty name');
  const cache = JSON.parse(localStorage.getItem(CACHE_KEY) || '{}');
  if(!opts.forceOnline && cache[key]) return cache[key];

  const base = baseStats(name);
  let summary = null, pv = null;
  try{
    summary = await fetchWikiSummary(name);
    pv = await fetchPageviews(name);
  }catch(e){
    summary = null; pv = null;
  }
  let popFactor = base.popularity;
  if(typeof pv === 'number'){ const scaled = Math.log10(1+pv); popFactor = 0.6 + Math.tanh(scaled/2)*1.0; }
  else if(summary) popFactor = Math.min(1.2, base.popularity + 0.1);
  const extractLen = summary && summary.extract ? Math.min(2000, summary.extract.length) : 0;
  const extractBoost = Math.min(0.2, extractLen/2000 * 0.2);

  const offense = Math.min(1.6, base.offense * (0.9 + popFactor*0.15) + extractBoost*0.25);
  const defense = Math.min(1.6, base.defense * (0.9 + popFactor*0.12));
  const form = Math.min(1.4, base.form * (0.95 + popFactor*0.08));
  const discipline = Math.min(1.4, base.discipline * (0.95 + (1/(1+Math.exp(-((popFactor-1)*3))))*0.08));

  const out = {
    name: summary && summary.title ? summary.title : name,
    thumbnail: summary && summary.thumbnail ? summary.thumbnail : null,
    offense, defense, form, discipline, pageviews: pv || 0,
    source: (summary || pv) ? 'wiki-augmented' : 'simulated'
  };

  cache[key] = out;
  localStorage.setItem(CACHE_KEY, JSON.stringify(cache));
  return out;
}

/* ---------------- Models per sport ---------------- */

// football: xG function
function computeFootballXG(a,b, homeA=false){
  const baseA = a.offense*0.6 + a.form*0.3 + (a.pageviews?Math.log10(1+a.pageviews):0.1)*0.1;
  const baseB = b.offense*0.6 + b.form*0.3 + (b.pageviews?Math.log10(1+b.pageviews):0.1)*0.1;
  const xgA_raw = 1.0 * (baseA / (baseA + b.defense)) * 2.2;
  const xgB_raw = 1.0 * (baseB / (baseB + a.defense)) * 2.2;
  let xgA = xgA_raw + (homeA?0.20:0);
  let xgB = xgB_raw + (homeA?0:0);
  xgA = Math.max(0.05, Math.min(5.0, xgA));
  xgB = Math.max(0.05, Math.min(5.0, xgB));
  return { xgA, xgB, baseA, baseB };
}
function poissonProb(k, lambda){ return Math.pow(lambda,k) * Math.exp(-lambda) / factorial(k); }
function factorial(n){ let f=1; for(let i=2;i<=n;i++) f*=i; return f; }
function samplePoisson(lambda, rnd=Math.random){ const L=Math.exp(-lambda); let k=0, p=1; do{ k++; p*=rnd(); } while(p > L && k < 30); return k-1; }

// basketball: expected points mapping
function computeBasketpoints(a,b, homeA=false){
  const offA = a.offense * 110; // scale
  const offB = b.offense * 110;
  const defA = a.defense * 110;
  const defB = b.defense * 110;
  let expA = 95 + (offA - defB)/10 + (a.form - 0.7)*12 + (homeA?3:0);
  let expB = 95 + (offB - defA)/10 + (b.form - 0.7)*12 + (homeA?0:0);
  expA = Math.max(60, Math.min(150, expA));
  expB = Math.max(60, Math.min(150, expB));
  return { expA, expB };
}
function gaussianSample(mean, sd, rnd=Math.random){
  let u=0,v=0; while(u===0) u=rnd(); while(v===0) v=rnd();
  const z = Math.sqrt(-2.0*Math.log(u))*Math.cos(2*Math.PI*v);
  return Math.round(mean + z*sd);
}

// tennis: per-set win prob -> simulate best-of-3
function tennisPerSetProb(a,b){
  const sa = a.offense*0.6 + a.form*0.3 + (a.defense*0.1);
  const sb = b.offense*0.6 + b.form*0.3 + (b.defense*0.1);
  const diff = sa - sb;
  const p = 1 / (1 + Math.exp(-diff*1.6));
  return Math.max(0.02, Math.min(0.98, p));
}

/* event generation helpers */
function genFootballEvents(a,b, gA,gB){
  const foulsA = 8 + Math.round((1 - a.discipline)*10 + a.offense*2 + gA*1.5);
  const foulsB = 8 + Math.round((1 - b.discipline)*10 + b.offense*2 + gB*1.5);
  const cornersA = Math.max(0, Math.round(a.offense*4 + gA + Math.random()*3));
  const cornersB = Math.max(0, Math.round(b.offense*4 + gB + Math.random()*3));
  const yellowA = Math.min(6, Math.round(foulsA/3 + Math.random()*2));
  const yellowB = Math.min(6, Math.round(foulsB/3 + Math.random()*2));
  const redA = (Math.random() < Math.max(0.01, (0.08 - a.discipline*0.04))) ? 1 : 0;
  const redB = (Math.random() < Math.max(0.01, (0.08 - b.discipline*0.04))) ? 1 : 0;
  return { foulsA,foulsB,cornersA,cornersB,yellowA,yellowB,redA,redB };
}
function genBasketStats(a,b, sA,sB){
  const rebA = Math.max(20, Math.round(a.offense*12 + Math.random()*10));
  const rebB = Math.max(20, Math.round(b.offense*12 + Math.random()*10));
  const toA = Math.max(5, Math.round((1-a.discipline)*10 + Math.random()*5));
  const toB = Math.max(5, Math.round((1-b.discipline)*10 + Math.random()*5));
  const foulsA = Math.max(10, Math.round((1-a.discipline)*8 + Math.random()*8));
  const foulsB = Math.max(10, Math.round((1-b.discipline)*8 + Math.random()*8));
  return { rebA,rebB,toA,toB,foulsA,foulsB };
}
function genTennisStats(a,b, setsA,setsB){
  const acesA = Math.max(0, Math.round(a.offense*3 + Math.random()*4));
  const acesB = Math.max(0, Math.round(b.offense*3 + Math.random()*4));
  const ufeA = Math.max(1, Math.round((1-a.defense)*10 + Math.random()*4));
  const ufeB = Math.max(1, Math.round((1-b.defense)*10 + Math.random()*4));
  return { acesA,acesB,ufeA,ufeB, setsA,setsB };
}

/* ---------- Orchestrator: single predict function ---------- */
async function predict(sport, nameA, nameB, opts={date:null, homeA:false}){
  const a = await getEntity(nameA, { forceOnline:true }).catch(()=>baseStats(nameA));
  const b = await getEntity(nameB, { forceOnline:true }).catch(()=>baseStats(nameB));

  // set thumbnail left
  setLogo('logoLeftImg', a.thumbnail);

  if(sport === 'football'){
    const { xgA,xgB } = computeFootballXG(a,b, opts.homeA);
    const seed = (hashString(nameA) ^ (hashString(nameB) << 1) ^ (opts.date ? hashString(opts.date) : 0)) >>> 0;
    const rnd = seededRng(seed);
    const gA = samplePoisson(xgA, rnd);
    const gB = samplePoisson(xgB, rnd);
    let pA=0,pB=0,pD=0; const maxG=7;
    for(let i=0;i<=maxG;i++) for(let j=0;j<=maxG;j++){
      const p = poissonProb(i,xgA)*poissonProb(j,xgB);
      if(i>j) pA+=p; else if(j>i) pB+=p; else pD+=p;
    }
    const tot = pA+pB+pD || 1; pA/=tot; pB/=tot; pD/=tot;
    const ev = genFootballEvents(a,b,gA,gB);
    return { sport:'football', a,b, xgA,xgB, goalsA:gA, goalsB:gB, pA,pB,pD, events:ev };
  } else if(sport === 'basketball'){
    const { expA, expB } = computeBasketpoints(a,b, opts.homeA);
    const seed = (hashString(nameA) ^ (hashString(nameB) << 1) ^ (opts.date ? hashString(opts.date) : 0)) >>> 0;
    const rnd = seededRng(seed);
    const sA = gaussianSample(expA, 10, rnd);
    const sB = gaussianSample(expB, 10, rnd);
    const diff = expA - expB;
    const pA = 1 / (1 + Math.exp(-diff/12));
    const pB = 1 - pA;
    const ev = genBasketStats(a,b,sA,sB);
    return { sport:'basketball', a,b, expA,expB, scoreA:sA, scoreB:sB, pA,pB, events:ev };
  } else if(sport === 'tennis'){
    const pSetA = tennisPerSetProb(a,b);
    const seed = (hashString(nameA) ^ (hashString(nameB) << 1) ^ (opts.date ? hashString(opts.date) : 0)) >>> 0;
    const rnd = seededRng(seed);
    let setsA=0, setsB=0; const setScores=[]
    while(setsA < 2 && setsB < 2){
      const r = rnd();
      if(r < pSetA){ setsA++; setScores.push('6-3'); } else { setsB++; setScores.push('3-6'); }
      if(setScores.length >= 5) break;
    }
    const winner = setsA > setsB ? nameA : nameB;
    const ev = genTennisStats(a,b,setsA,setsB);
    return { sport:'tennis', a,b, pSetA, setsA,setsB, setScores, winner, events:ev };
  }
}

/* ---------- UI wiring ---------- */

const sportEl = document.getElementById('sport');
const nameAEl = document.getElementById('nameA');
const nameBEl = document.getElementById('nameB');
const predictBtn = document.getElementById('predictBtn');
const simulateBtn = document.getElementById('simulateBtn');
const clearCacheBtn = document.getElementById('clearCache');
const homeAEl = document.getElementById('homeA');
const matchDateEl = document.getElementById('matchDate');

predictBtn.addEventListener('click', async ()=>{
  await runPredict({online:true});
});
simulateBtn.addEventListener('click', async ()=>{ await runPredict({online:false}); });
clearCacheBtn.addEventListener('click', ()=>{ localStorage.removeItem(CACHE_KEY); alert('Cache cleared'); });

async function runPredict(opts={online:true}){
  const sport = sportEl.value;
  const nameA = nameAEl.value.trim();
  const nameB = nameBEl.value.trim();
  const homeA = homeAEl.checked;
  const date = matchDateEl.value || null;
  if(!nameA || !nameB){ alert('Please enter both names'); return; }
  predictBtn.disabled = true; simulateBtn.disabled = true; predictBtn.textContent = opts.online ? 'Working...' : 'Simulating...';
  try{
    const res = await predict(sport, nameA, nameB, { date, homeA });
    displayResult(res);
  }catch(e){
    alert('Prediction error: ' + (e.message||e));
  }finally{
    predictBtn.disabled = false; simulateBtn.disabled = false; predictBtn.textContent = 'Predict (open sources)';
  }
}

function setLogo(id, url){
  const img = document.getElementById(id);
  if(url){ img.src = url; img.style.display = 'block'; }
  else { img.src=''; img.style.display='none'; }
}

function displayResult(r){
  document.getElementById('result').hidden = false;
  if(r.sport === 'football'){
    document.getElementById('scoreMain').textContent = `${r.goalsA}  —  ${r.goalsB}`;
    document.getElementById('matchLabel').textContent = `${r.a.name}  vs  ${r.b.name}`;
    document.getElementById('labelA').textContent = `${r.a.name} • win ${(r.pA*100).toFixed(1)}%`;
    document.getElementById('labelB').textContent = `${r.b.name} • win ${(r.pB*100).toFixed(1)}%`;
    document.getElementById('favText').textContent = r.pA > r.pB ? `${r.a.name} favored` : (r.pB > r.pA ? `${r.b.name} favored` : 'Draw likely');
    document.getElementById('sourceNote').textContent = `Sources: ${r.a.source}, ${r.b.source}`;
    document.getElementById('fillA').style.width = Math.max(2, r.pA*100) + '%';
    document.getElementById('fillB').style.width = Math.max(2, r.pB*100) + '%';

    // stats
    const main = document.getElementById('mainStats'); main.innerHTML = '';
    main.appendChild(stat('xG (A / B)', `${r.xgA.toFixed(2)} / ${r.xgB.toFixed(2)}`));
    main.appendChild(stat('Prob (A/B/Draw)', `${(r.pA*100).toFixed(1)}% / ${(r.pB*100).toFixed(1)}% / ${(r.pD*100).toFixed(1)}%`));
    const ev = document.getElementById('eventStats'); ev.innerHTML = '';
    ev.appendChild(stat('Fouls', `${r.events.foulsA} / ${r.events.foulsB}`));
    ev.appendChild(stat('Corners', `${r.events.cornersA} / ${r.events.cornersB}`));
    ev.appendChild(stat('Cards (Y/R)', `${r.events.yellowA}/${r.events.redA} / ${r.events.yellowB}/${r.events.redB}`));
    document.getElementById('explainBox').innerHTML = explainFootball(r);
    setLogo('logoLeftImg', r.a.thumbnail);
  } else if(r.sport === 'basketball'){
    document.getElementById('scoreMain').textContent = `${r.scoreA}  —  ${r.scoreB}`;
    document.getElementById('matchLabel').textContent = `${r.a.name}  vs  ${r.b.name}`;
    document.getElementById('labelA').textContent = `${r.a.name} • ${(r.pA*100).toFixed(1)}%`;
    document.getElementById('labelB').textContent = `${r.b.name} • ${(r.pB*100).toFixed(1)}%`;
    document.getElementById('fillA').style.width = Math.max(2, r.pA*100) + '%';
    document.getElementById('fillB').style.width = Math.max(2, r.pB*100) + '%';
    document.getElementById('favText').textContent = r.pA>r.pB? `${r.a.name} favored` : `${r.b.name} favored`;
    document.getElementById('sourceNote').textContent = `Sources: ${r.a.source}, ${r.b.source}`;
    const main = document.getElementById('mainStats'); main.innerHTML = '';
    main.appendChild(stat('Exp pts (A/B)', `${r.expA.toFixed(1)} / ${r.expB.toFixed(1)}`));
    main.appendChild(stat('Final score', `${r.scoreA} — ${r.scoreB}`));
    const ev = document.getElementById('eventStats'); ev.innerHTML = '';
    ev.appendChild(stat('Rebounds (A/B)', `${r.events.rebA} / ${r.events.rebB}`));
    ev.appendChild(stat('Turnovers (A/B)', `${r.events.toA} / ${r.events.toB}`));
    document.getElementById('explainBox').innerHTML = explainBasket(r);
    setLogo('logoLeftImg', r.a.thumbnail);
  } else if(r.sport === 'tennis'){
    document.getElementById('scoreMain').textContent = `${r.setsA} — ${r.setsB}`;
    document.getElementById('matchLabel').textContent = `${r.a.name}  vs  ${r.b.name}`;
    document.getElementById('labelA').textContent = `${r.a.name} • per-set ${(r.pSetA*100).toFixed(1)}%`;
    document.getElementById('labelB').textContent = `${r.b.name} • per-set ${(100-r.pSetA*100).toFixed(1)}%`;
    document.getElementById('fillA').style.width = Math.max(2, r.pSetA*100) + '%';
    document.getElementById('fillB').style.width = Math.max(2, (1-r.pSetA)*100) + '%';
    document.getElementById('favText').textContent = r.winner ? `${r.winner} predicted` : '';
    document.getElementById('sourceNote').textContent = `Sources: ${r.a.source}, ${r.b.source}`;
    const main = document.getElementById('mainStats'); main.innerHTML = '';
    main.appendChild(stat('Set chance (A)', `${(r.pSetA*100).toFixed(1)}%`));
    main.appendChild(stat('Set scores', `${r.setScores.join(', ')}`));
    const ev = document.getElementById('eventStats'); ev.innerHTML = '';
    ev.appendChild(stat('Aces (A/B)', `${r.events.acesA} / ${r.events.acesB}`));
    ev.appendChild(stat('Unforced errors (A/B)', `${r.events.ufeA} / ${r.events.ufeB}`));
    document.getElementById('explainBox').innerHTML = explainTennis(r);
    setLogo('logoLeftImg', r.a.thumbnail);
  }
}

// small helpers for UI
function stat(title, html){
  const d = document.createElement('div'); d.className='stat';
  d.innerHTML = `<div class="muted">${title}</div><div style="margin-top:6px">${html}</div>`;
  return d;
}
function explainFootball(r){ return `<strong>Explain — Football</strong><ol><li>Deterministic base strengths from names (offense/defense/form).</li><li>Wikipedia & pageviews nudge strengths when found.</li><li>Expected goals (xG) derived from strengths; home adds +0.2 xG.</li><li>Score sampled via Poisson(xG); win/draw probs computed by joint Poisson.</li><li>Fouls/corners/cards estimated heuristically from discipline & offense.</li></ol>`; }
function explainBasket(r){ return `<strong>Explain — Basketball</strong><ol><li>Offense/defense/form estimated from names & wiki signals.</li><li>Expected points computed and realistic final score sampled with normal noise.</li><li>Winner probability approximated by logistic of expected difference.</li><li>Rebounds/turnovers simulated for context.</li></ol>`; }
function explainTennis(r){ return `<strong>Explain — Tennis</strong><ol><li>Per-set win prob from strengths using logistic.</li><li>Sets simulated (best-of-3); winner determined by sets won.</li><li>Aces/unforced errors estimated heuristically.</li></ol>`; }

/* small initialization */
document.addEventListener('DOMContentLoaded', ()=>{
  if(!localStorage.getItem('sporty_prefill_v1')){
    document.getElementById('nameA').value = 'Team A';
    document.getElementById('nameB').value = 'Team B';
    localStorage.setItem('sporty_prefill_v1','1');
  }
});
</script>
</body>
</html>
